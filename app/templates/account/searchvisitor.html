{% extends "app/layout.html" %}
{% load crispy_forms_tags %}

{% block content %}
<br>

<div class="container">
    <div class="card mx-auto card-container w-50 p-5">
        <h1 class="card-title">Enter the name of Visitor</h1>
        <form method="post" action="" class="autocomplete-me">
            <div class="form-group row">
                <input type="text" class="textinput textInput form-control" name="search" id="search">
                <div id="search-results"></div>
            </div>
        </form>
        <h1 class="card-title">Or add multiple visitor</h1>
        <form action="{% url 'search_visitor' slug=slug %}" method="post">
            {% csrf_token %}
            {{form|crispy}}
            <div class="form-group mx-auto">
                <button type="submit" class="btn btn-primary">Save Visit</button>
                <button type="submit" class="btn btn-secondary">Save And Create New One</button>
                <a href="{% url 'logbook' slug=slug %}" class="btn btn-success">Cancel</a>
                <input type="hidden" name="next" value="{{next}}">
            </div>
        </form>
    </div>
</div>
<script>
    {% block jquery %}
    $(function () {
        var slug = window.location.pathname;
        var metaslug = slug.split('/');
        console.log(metaslug[1]);
        $('#search').keyup(function () {
            $.ajax({
                method: 'POST',
                url: '../../' + metaslug[1] + '/searchlist/',
                data: {
                    'search_text': $('#search').val(),
                },
                beforeSend: function (xhr) {
                    xhr.setRequestHeader(
                        "X-CSRFToken",
                        "{{ csrf_token }}"
                    );
                },
                success: searchSuccess,
                dataType: 'html',
                error: function (error_data) {
                    console.log("error");
                    console.log(error_data);
                }
            })
        })
    });

    function searchSuccess(data, textStatus, jqXHR) {
        $('#search-results').html(data);
    }
    {% endblock %}
</script>
{% endblock %}